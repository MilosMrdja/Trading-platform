

<!-- Overlay -->
<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4">
  <!-- Modal -->
  <div class="w-full max-w-md h-2/3 overflow-auto bg-white rounded-lg shadow-md dark:bg-gray-800 p-6 relative">
    <button
      (click)="closeModal()"
      class="absolute top-8 right-10 text-gray-500 hover:text-gray-800 dark:hover:text-white"
      aria-label="Close modal"
    >
      âœ•
    </button>
    <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">
      {{ tradeToEdit ? 'Edit Trade' : 'Add Trade' }}
    </h2>

    <form [formGroup]="tradeForm" (ngSubmit)="onSubmit()">

      <!-- Account Dropdown -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="accountName">Account</label>
        <select
          id="accountName"
          formControlName="accountName"
          class="block w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
        >
          <option *ngIf="!tradeToEdit" value="" disabled>Select Account</option>

          <option *ngIf="tradeToEdit">
            {{ tradeToEdit.account.name }}
          </option>

          <ng-container *ngIf="!tradeToEdit">
            <option *ngFor="let acc of accountOptionsList" [value]="acc.id">
              {{ acc.name }}
            </option>
          </ng-container>
        </select>
      </div>


      <!-- Instrument Dropdown -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="instrumentId">Instrument</label>
        <select
          id="instrumentId"
          formControlName="instrumentId"
          class="block w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
        >
          <option *ngIf="!tradeToEdit" value="" disabled>Select Instrument</option>

          <option *ngIf="tradeToEdit">
            {{ tradeToEdit.instrument.code }}
          </option>

          <ng-container *ngIf="!tradeToEdit">
            <option *ngFor="let inst of instrumentOptionsList" [value]="inst.id">
              {{ inst.code }}
            </option>
          </ng-container>
        </select>
      </div>


      <!-- Quantity -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="quantity">Quantity</label>
        <input
          type="number"
          id="quantity"
          formControlName="quantity"
          class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        />
        <div class="text-red-600 mt-1 text-sm" *ngIf="quantity.invalid && (quantity.dirty || quantity.touched)">
          <div *ngIf="quantity.errors?.['required']">Quantity is required.</div>
          <div *ngIf="quantity.errors?.['min']">Quantity must be greater than 0.</div>
        </div>
      </div>

      <!-- Price -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="price">Price</label>
        <input
          type="number"
          step="0.01"
          id="price"
          formControlName="price"
          class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        />
        <div class="text-red-600 mt-1 text-sm" *ngIf="price.invalid && (price.dirty || price.touched)">
          <div *ngIf="price.errors?.['required']">Price is required.</div>
          <div *ngIf="price.errors?.['min']">Price must be positive.</div>
        </div>
      </div>

      <!-- Direction -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="direction">Direction</label>
        <select
          id="direction"
          formControlName="direction"
          [disabled]="tradeToEdit != null"
          class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        >
          <option value="" disabled>Select direction</option>
          <option value="BUY">Buy</option>
          <option value="SELL">Sell</option>
        </select>
        <div class="text-red-600 mt-1 text-sm" *ngIf="direction.invalid && (direction.dirty || direction.touched)">
          <div *ngIf="direction.errors?.['required']">Direction is required.</div>
        </div>
      </div>

      <!-- Delivery Type -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="deliveryType">Delivery Type</label>
        <select
          id="deliveryType"
          formControlName="deliveryType"
          class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        >
          <option value="" disabled>Select delivery type</option>
          <option value="PHYSICAL_DELIVERY">Physical</option>
          <option value="CASH">Cash</option>
        </select>
        <div class="text-red-600 mt-1 text-sm" *ngIf="deliveryType.invalid && (deliveryType.dirty || deliveryType.touched)">
          <div *ngIf="deliveryType.errors?.['required']">Delivery type is required.</div>
        </div>
      </div>

      <!-- Unit -->
      <div class="mb-4">
        <label class="block text-gray-700 dark:text-gray-200 mb-1" for="unit">Unit</label>
        <select
          id="unit"
          formControlName="unit"
          class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
        >
          <option value="" disabled>Select unit</option>
          <option value="PER_UNIT">Per Unit</option>
          <option value="PER_KG">Per Kg</option>
          <option value="PER_TONE">Per Tone</option>
        </select>
        <div class="text-red-600 mt-1 text-sm" *ngIf="unit.invalid && (unit.dirty || unit.touched)">
          <div *ngIf="unit.errors?.['required']">Unit is required.</div>
        </div>
      </div>


      <button
        type="submit"
        [disabled]="tradeForm.invalid"
        class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
      >
        {{ tradeToEdit ? 'Update' : 'Add' }}
      </button>
    </form>
  </div>
</div>

<app-toast></app-toast>
